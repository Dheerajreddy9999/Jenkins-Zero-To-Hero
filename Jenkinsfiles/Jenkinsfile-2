pipeline {
    agent {
        kubernetes {
            yaml '''
            apiVersion: v1
            kind: Pod
            metadata:
            spec:
              serviceAccount: jenkins
              containers:
              - name: maven
                image: maven:3.8.6-openjdk-8-slim
                command:
                - cat
                tty: true
                volumeMounts:
                - mountPath: "/root/.m2/repository"
                  name: maven-cache
              volumes:
              - name: maven-cache
                persisitentVolumeClaim:
                  claimName: maven-cache
            '''
        }
    }


    stages{

        stage('UNIT TEST') {
         steps {
            container ('maven') {
                sh 'mvn test'
            }
         }
      }


      stage('INTEGRATION TEST') {
         steps {
             container ('maven') {
                 sh 'mvn verify -DskipUnitTests'
            }
         }      
      }

      stage ('Build') {
            steps {
                container ('maven') {
                    sh 'mvn clean install -DskipTests'
                }
            }
        }

      stage('CODE ANALYSIS WITH CHECKSTYLE') {
         steps {
            container ('maven') {
                  sh 'mvn checkstyle:checkstyle'
            }
         }
      }

    }
}
